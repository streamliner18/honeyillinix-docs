<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HoneyIllinix 391 MP 3: paging.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HoneyIllinix 391 MP 3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">paging.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="paging_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//Author: Michael Gulson</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//Date: 3/9/19</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="types_8h.html">types.h</a>&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="x86__desc_8h.html">x86_desc.h</a>&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="lib_8h.html">lib.h</a>&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="paging_8h.html">paging.h</a>&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//Create a page directory and page table with valid</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//directory entries and page table entries</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//paging-allows each process to see a full virtual address space user</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">https://wiki.osdev.org/Paging</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">https://courses.engr.illinois.edu/ece391/sp2019/secure/references/IA32-ref-manual-vol-3.pdf</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">pg 90</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">page directory              page table                  physical memory</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">|--32 bits--|               |----32 bits---|      0MB   |               |</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">                                                        |               |</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">____________                ____________        0xB8000 |_______________|</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">|___________|  ----------&gt;  |___________|               |  video memory |</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">|___________|  -            |___________|       0xB9000 |---------------|</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">|___________|   -           |___________|               |               |</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">|___________|     -         |___________|        4MB    |_______________|</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">|           |      -                                    |               |</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">-------------        ------&gt;____________                |               |</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">                            |___________|               | Kernel        |</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">                            |___________|               |               |</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">                            |___________|        8MB    |---------------|</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">                            |___________|                       .</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">                                                                .</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">                                                                .</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">                                                          _____________</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">                                                        |              |</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">                                                        |--------------|</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">                                                    4GB</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">page directory entry (4 KB)</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">|--32 bits--|</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">31                    13 12  9 8  7 6 5   4  3   2  1 0</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">|page-Table Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">page-directory entry (4 MB)</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">|--32 bits--|</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">31               22 21     13 12  9 8  7 6 5  4   3   2  1 0</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">|page Base Address| Reserved |Avail|G|PS|0|A|PCD|PWT|US|RW|P|</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">    page Table entry (4 KB page)</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">|--32 bits--|</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">31                    13 12    9 8  7 6 5  4  3  2  1 0</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">|      page Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">Virtual Memory Address</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">|--32 bits--|</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">31               22  21       12   9 8  7 6 5  4   3   2  1 0</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">|   Directory      |  Table   |        Offset               |</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">P(bit 0)- present, indicates whether page or page table is present</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">R/W  (bit 1)</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">U/S  (bit 2)              (finish this Mak)</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">PWT  (bit 3)</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">PCD  (bit 4)                (Cache disabled)</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">A    (bit 5)                (Accessed)</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">0    (bit 6)                (Reserved - set to 0)</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">PS   (bit 7)                (Page size (0 indicates 4 KBytes))</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">G    (bit 8)                (Global page (Ignored))</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">Avail(bit 9)                (Available for system programmers use)</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">PS(bit 7)- page size indicating 4KB vs 4MB</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">SOME CR documentation, figure out MAK</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">Page Table</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">A Page Table Entry</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">In each page table, as it is, there are also 1024 entries. These are called page table entries, and are very similar to page directory entries.</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">Note: Only explanations of the bits unique to the page table are below.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">The first item, is once again, a 4-KiB aligned physical address. Unlike previously, however, the address is not that of a page table, but instead a 4 KiB block of physical memory that is then mapped to that location in the page table and directory.</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">C, or Cached, is the &#39;D&#39; bit from the previous table</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">G, or the Global, flag, if set, prevents the TLB from updating the address in its cache if CR3 is reset. Note, that the page global enable bit in CR4 must be set to enable this feature.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">D, or the Dirty flag, if set, indicates that page has been written to. This flag is not updated by the CPU, and once set will not unset itself.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">0, if PAT is supported, shall indicate the memory type. Otherwise, it must be 0.</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">From OSDEV</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">Enabling</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">Enabling paging is actually very simple. All that is needed is to load CR3 with the address of the page directory and to set the paging (PG) and protection (PE) bits of CR0. Note: setting the paging flag when the protection flag is clear causes a general-protection exception.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"> mov eax, page_directory</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> mov cr3, eax</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> mov eax, cr0</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> or eax, 0x80000001</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> mov cr0, eax</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> To enable PSE (4 MiB pages) the following code is required.</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> mov eax, cr4</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> or eax, 0x00000010</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> mov cr4, eax</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="paging_8c.html#a708e40467feb1c2109c63cdf12d88c29">  118</a></span>&#160;<span class="preprocessor">#define VIDEO     0xB8000</span></div><div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="paging_8c.html#ab7a6934cb4cdabf546c8f6243325d40d">  119</a></span>&#160;<span class="preprocessor">#define EIGHTEENBITMASK  0x3FFF</span></div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="paging_8c.html#ab2ccbad8d1a8bc2c887cb7818d20dcdf">  120</a></span>&#160;<span class="preprocessor">#define EIGHTEEN    18</span></div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="paging_8c.html#a4f8d84d2384ee836767057f751b4b809">  121</a></span>&#160;<span class="preprocessor">#define TENBITMASK  0x3FF</span></div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="paging_8c.html#aabc53aa7e6353d8f58b8ae93fd015fab">  122</a></span>&#160;<span class="preprocessor">#define TEN         10</span></div><div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="paging_8c.html#a66d0a76964334ef04b1f9aec7911b35d">  123</a></span>&#160;<span class="preprocessor">#define PGDIRSIZE   1024    //size of page directory</span></div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="paging_8c.html#a9e08e3962b168376ed9a2bd84a1b990c">  124</a></span>&#160;<span class="preprocessor">#define PGTBLSIZE   1024     //size of page table</span></div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="paging_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">  125</a></span>&#160;<span class="preprocessor">#define P         0</span></div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="paging_8c.html#afc4ded33ac0ca43defcce639e965748a">  126</a></span>&#160;<span class="preprocessor">#define RW        1</span></div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="paging_8c.html#a89f9bd364d17d48182d34357c3508d05">  127</a></span>&#160;<span class="preprocessor">#define US        2</span></div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="paging_8c.html#a1e9265ff80666460b21354ada7b94d55">  128</a></span>&#160;<span class="preprocessor">#define PWT       3</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="paging_8c.html#ad462355b784b18710eedd8e0557f7e25">  129</a></span>&#160;<span class="preprocessor">#define PCD       4</span></div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="paging_8c.html#a955f504eccf76b4eb2489c0adab03121">  130</a></span>&#160;<span class="preprocessor">#define A         5</span></div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="paging_8c.html#afad3d8b3d66fceadb1732af784734c75">  131</a></span>&#160;<span class="preprocessor">#define SIX       6</span></div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="paging_8c.html#ad7f630556c2cd30d8d8976e0f6e7f749">  132</a></span>&#160;<span class="preprocessor">#define PS        7</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="paging_8c.html#aed9ea78689ecce0b7264c02c7f8a9a54">  133</a></span>&#160;<span class="preprocessor">#define G         8</span></div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="paging_8c.html#aeba7b3d514ccf2bab64ef5e363c6396a">  134</a></span>&#160;<span class="preprocessor">#define TWELVEMASK    0xFFFFF000</span></div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="paging_8c.html#a65e6604e8c6e54fdc7f706be201f115e">  135</a></span>&#160;<span class="preprocessor">#define TWELVE      12</span></div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="paging_8c.html#a47ad7d9c1b4851726bb2539f00712d1e">  136</a></span>&#160;<span class="preprocessor">#define PGBASEKBADDROFFSET     13</span></div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="paging_8c.html#acc66a42a1c41f80ef29361640e1594a6">  137</a></span>&#160;<span class="preprocessor">#define PHYSPGADDROFFSET        13</span></div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="paging_8c.html#a7723ed8ed96291407b9707defcfc0ce9">  138</a></span>&#160;<span class="preprocessor">#define PGBASEMBADDROFFSET      23</span></div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="paging_8c.html#ad4661974a66daba2cf78a74dfbe67ebf">  139</a></span>&#160;<span class="preprocessor">#define MEMSIZE                 4096  //4096</span></div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="paging_8c.html#ab1d3a099dfc5b96c6756928945cfcb70">  140</a></span>&#160;<span class="preprocessor">#define RESTMEMSIZE             998     //Holds size rest_of_mem[array ]</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="paging_8c.html#ae48e0a3cbad0db6c193274ff56038e0d">  141</a></span>&#160;<span class="preprocessor">#define KERNEL_LOC          4194304    // 1024^2 *4</span></div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="paging_8c.html#a2c8ee1c80049202f732a07a4e45af7c0">  142</a></span>&#160;<span class="preprocessor">#define HARDCODEPGTBL0    3758096385</span></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="paging_8c.html#aa3563d3079ed62c037a8a8d8d6bc6ecd">  143</a></span>&#160;<span class="preprocessor">#define VIDEOINDEX      0xB8</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">//      |      page Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">//int32_t 32 bit int</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> pgDir[<a class="code" href="paging_8c.html#a66d0a76964334ef04b1f9aec7911b35d">PGDIRSIZE</a>] <a class="code" href="paging_8c.html#a8e4a32a7b73774ffd986b8fc2399829b">__attribute__</a>((aligned (<a class="code" href="paging_8c.html#ad4661974a66daba2cf78a74dfbe67ebf">MEMSIZE</a>)));</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> pgTbl[<a class="code" href="paging_8c.html#a9e08e3962b168376ed9a2bd84a1b990c">PGTBLSIZE</a>] <a class="code" href="paging_8c.html#a8e4a32a7b73774ffd986b8fc2399829b">__attribute__</a>((aligned (<a class="code" href="paging_8c.html#ad4661974a66daba2cf78a74dfbe67ebf">MEMSIZE</a>)));</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">//make sure we</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">//initialize to zero</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="paging_8c.html#a736169a1f5153bc211617999089d7db0">  159</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="paging_8c.html#a736169a1f5153bc211617999089d7db0">set_dir_tbl_zero</a>(){</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">for</span>(i=0; i &lt; <a class="code" href="paging_8c.html#a66d0a76964334ef04b1f9aec7911b35d">PGDIRSIZE</a>; i++){</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    pgDir[i] = 0;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="keywordflow">for</span>(i=0; i &lt; <a class="code" href="paging_8c.html#a66d0a76964334ef04b1f9aec7911b35d">PGDIRSIZE</a>; i++){</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    pgTbl[i] = 0;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;}</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="paging_8h.html#a1ba54f994a3bcceea6b1904cde7de8fe">  172</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(<a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> * num, <span class="keywordtype">char</span> bitNum){</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  *num |= 1UL &lt;&lt; bitNum;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="paging_8h.html#a8de9701e91cb1faf82d939d43aa6b305">  177</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="paging_8c.html#a8de9701e91cb1faf82d939d43aa6b305">clear_bit</a>(<a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> * num, <span class="keywordtype">char</span> bitNum){</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  *num &amp;= ~(1UL &lt;&lt; bitNum);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">/* insert_directory_entry</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"> * Inputs: isKB(bit 7 PS), physMemAddr(page base address), isPresent(bit 0 P)</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment"> * Return Value: zero if functions, -1 if fail</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment"> * Function: fills page directory and table*/</span></div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="paging_8h.html#ae4f40bc32fc92f5b6bb29f837746fb4f">  188</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="paging_8c.html#ae4f40bc32fc92f5b6bb29f837746fb4f">insert_directory_entry</a>(<span class="keywordtype">int</span> isKB, <a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> physMemAddr, <span class="keywordtype">int</span> isPresent){</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> physMemAddrTop2, physMemAddrBottom18;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> pgTblBitmask;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">//int32_t virtualAddress;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a> newPgDirEntry, newPgTblEntry;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">/*pgDir[0] =0;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">  pgDir[1] =1;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">  pgDir[2] =1024;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">  pgDir[3] = 129;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">  pgTbl[0] =2;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">  pgTbl[1] = HARDCODEPGTBL0;*/</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="comment">//initialize visual memory</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <span class="comment">/*page-directory entry (4 KB)</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">      31                   13 12   9 8  7 6 5  4  3   2  1 0</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">      |      page Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|  */</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <span class="comment">//set P(bit0) to isPresent</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="comment">// the top 18 bits should point to pgTbl</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  newPgDirEntry = (<a class="code" href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a>)pgTbl &amp; <a class="code" href="paging_8c.html#aeba7b3d514ccf2bab64ef5e363c6396a">TWELVEMASK</a>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgDirEntry, <a class="code" href="paging_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgDirEntry, <a class="code" href="paging_8c.html#afc4ded33ac0ca43defcce639e965748a">RW</a>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  </div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="comment">//set PS(bit7) to 0 for KB</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">//clear_bit(&amp;newPgDirEntry, PS); //already zero</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="comment">//clear bit 6</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">//clear_bit(&amp;newPgDirEntry2, SIX);</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  pgDir[0] = newPgDirEntry;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">/*    page-directory entry (4 MB)</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">    |--32 bits--|</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">    31               22 21     13 12  9 8  7 6 5  4   3   2  1 0</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">    |page Base Address| Reserved |Avail|G|PS|0|A|PCD|PWT|US|RW|P|*/</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  newPgDirEntry = (<a class="code" href="paging_8c.html#ae48e0a3cbad0db6c193274ff56038e0d">KERNEL_LOC</a> &amp; <a class="code" href="paging_8c.html#aeba7b3d514ccf2bab64ef5e363c6396a">TWELVEMASK</a>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgDirEntry, <a class="code" href="paging_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgDirEntry, <a class="code" href="paging_8c.html#afc4ded33ac0ca43defcce639e965748a">RW</a>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  <span class="comment">//set PS(bit7) to 1 for MB</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;  </div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="comment">//set RW</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgDirEntry, <a class="code" href="paging_8c.html#ad7f630556c2cd30d8d8976e0f6e7f749">PS</a>);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  pgDir[1] = newPgDirEntry;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  </div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="comment">/*    page Table entry (4 KB page)</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">      |--32 bits--|</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">      31                    13 12    9 8  7 6 5  4  3  2  1 0</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">      |      page Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|    */</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  newPgTblEntry = (<a class="code" href="paging_8c.html#a708e40467feb1c2109c63cdf12d88c29">VIDEO</a> &amp; <a class="code" href="paging_8c.html#aeba7b3d514ccf2bab64ef5e363c6396a">TWELVEMASK</a>);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgTblEntry, <a class="code" href="paging_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <a class="code" href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a>(&amp;newPgTblEntry, <a class="code" href="paging_8c.html#afc4ded33ac0ca43defcce639e965748a">RW</a>);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  </div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">//set RW</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">//set PS(bit7) to 1 for MB</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="comment">//set_bit_one(&amp;newPgDirEntry, PS);</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  pgTbl[<a class="code" href="paging_8c.html#aa3563d3079ed62c037a8a8d8d6bc6ecd">VIDEOINDEX</a>] = newPgTblEntry;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;}</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">/*int insert_directory_entry(int isKB, int32_t physMemAddr, int isPresent){</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">  //finished for isKB =1</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">  int32_t physMemAddrTop2, physMemAddrBottom18;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">  //int32_t virtualAddress;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">  int32_t newPgDirEntry1, newPgDirEntry2, newPgTblEntry1, newPgTblEntry2;</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">  int i,*/</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">/*j,*/</span> <span class="comment">/* availDirIndex1, availDirIndex2 , availTblIndex1, availTblIndex2;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">//nullptr/length check??? impliment later</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">  int check;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">  check =1;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">  if(check!=1){</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">    return -1;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">  if(isKB){</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">      //find space in page directory</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">    for (i = 0; i &lt; PGDIRSIZE; i++) {</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">      if(pgDir[i]==0&amp;&amp;pgDir[i+1]==0){break;}</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">    availDirIndex1 =  i;</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">    availDirIndex2 = availDirIndex1 + 1;</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">      for (i = 0; i &lt; PGTBLSIZE; i++) {</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">      if(pgTbl[i]==0&amp;&amp;pgDir[i+1]==0){break;}</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">    availTblIndex1 = i;</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">    availTblIndex2 = availTblIndex1 + 1;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">      newPgDirEntry1 = 0;</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">    newPgDirEntry2 = availTblIndex1 &lt;&lt; PGBASEKBADDROFFSET;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         <span class="comment">/*page-directory entry (4 KB)</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">      31                   13 12   9 8  7 6 5  4  3   2  1 0</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">      |      page Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|  */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;         <span class="comment">//set P(bit0) to isPresent</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">      set_bit_one(&amp;newPgDirEntry2, P);</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">      //set PS(bit7) to 0 for KB</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">      clear_bit(&amp;newPgDirEntry2, PS);</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">      //clear bit 6</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">      clear_bit(&amp;newPgDirEntry2, SIX);</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">      //set pg dir with appropriate info</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">      pgDir[availDirIndex1] = newPgDirEntry1;</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">      pgDir[availDirIndex2] = newPgDirEntry2;</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">      */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">/*  page Table entry (4 KB page)</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">      |--32 bits--|</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">      31                    13 12    9 8  7 6 5  4  3  2  1 0</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">      |      page Base Address|Avail|G|PS|0|A|PCD|PWT|US|RW|P|    */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">//set page table with appropriate info</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">//set extended bits</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">    physMemAddrTop2 = physMemAddr &gt;&gt; EIGHTEEN;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">    newPgTblEntry1 = physMemAddrTop2;</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">    physMemAddrBottom18 =  physMemAddr &amp; EIGHTEENBITMASK;</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">      newPgTblEntry2 = physMemAddrBottom18 &lt;&lt; PHYSPGADDROFFSET;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">           //set P(bit0) to isPresent</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">      set_bit_one(&amp;newPgTblEntry2, P);</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">      //set PS(bit7) to 0 for KB</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">      clear_bit(&amp;newPgTblEntry2, PS);</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">      //clear bit 6</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">      clear_bit(&amp;newPgTblEntry2, SIX);</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">      pgTbl[availDirIndex1] = newPgTblEntry1;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">      pgTbl[availDirIndex2] = newPgTblEntry2;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">  else{</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">    for (i = 0; i &lt; PGDIRSIZE; i++) {</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">      if(pgDir[i]==0&amp;&amp;pgDir[i+1]==0){break;}</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">    availDirIndex1 =  i;</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">    availDirIndex2 = availDirIndex1 + 1;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">      for (i = 0; i &lt; PGTBLSIZE; i++) {</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">      if(pgTbl[i]==0&amp;&amp;pgDir[i+1]==0){break;}</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">    availTblIndex1 = i;</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">    availTblIndex2 = availTblIndex1 + 1;</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">    physMemAddrTop2 = physMemAddr &gt;&gt; TEN;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">    newPgDirEntry1 = physMemAddrTop2;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">    physMemAddrBottom18 =  physMemAddr &amp; TENBITMASK;</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">    newPgDirEntry2 = physMemAddrBottom18 &lt;&lt; PGBASEMBADDROFFSET;</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">      //newPgDirEntry1 = 0;</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">    //newPgDirEntry2 = availTblIndex &lt;&lt; PGBASEMBADDROFFSET;</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">/*  page-directory entry (4 MB)</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">    |--32 bits--|</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">    31               22 21     13 12  9 8  7 6 5  4   3   2  1 0</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">    |page Base Address| Reserved |Avail|G|PS|0|A|PCD|PWT|US|RW|P|*/</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">    //set P(bit0) to isPresent</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">    set_bit_one(&amp;newPgDirEntry2, P);</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">    //set PS(bit7) to 1 for MB</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">    set_bit_one(&amp;newPgDirEntry2, PS);</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">    //clear bit 6</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">    clear_bit(&amp;newPgDirEntry2, SIX);</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">    pgDir[availDirIndex1] = newPgDirEntry1;</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">  pgDir[availDirIndex2] = newPgDirEntry2;</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">  return 0;</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">}</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">//returns an array of virtual array.</span></div><div class="line"><a name="l00371"></a><span class="lineno"><a class="line" href="paging_8h.html#a148dd03ddfff0c042f59ae1675e45b55">  371</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="paging_8c.html#a148dd03ddfff0c042f59ae1675e45b55">initialize_memory_mp3</a>(<span class="keywordtype">void</span>){</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="comment">//initialize directory entry for video memory</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">// virtual_mem_packet init_mem ;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<a class="code" href="paging_8c.html#a736169a1f5153bc211617999089d7db0">set_dir_tbl_zero</a>();</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<a class="code" href="paging_8c.html#ae4f40bc32fc92f5b6bb29f837746fb4f">insert_directory_entry</a>(0, <a class="code" href="paging_8c.html#a708e40467feb1c2109c63cdf12d88c29">VIDEO</a>, 0);  <span class="comment">//technically inputs don&#39;t matter because I hard coded</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<a class="code" href="paging_8c.html#a1296393006772da66203c41cc9c6b0e7">set_registers</a>();</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<a class="code" href="paging_8c.html#a75c9458effb320dbbbcec2dec2461e98">flush_tlb</a>();</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">//set_registers();</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">//flush_tlb();</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">//The physical mem address for video memory will be 0xB8000</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">//int insert_directory_entry(int isKB, int32_t physMemAddr, int isPresent){</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">//if(insert_directory_entry(1, VIDEO, 1)!=0){   return -1;}//</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; <span class="comment">//initialize directory entry for kernel memory</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">//if(insert_directory_entry(0,KERNEL_SIZE , 1)!=0){return -1;}</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">/*TA Peter said we dont need this */</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; <span class="comment">//initialize directory entry for rest of memory (not present)</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">// int insert_directory_entry(bool isKB, int32_t physMemAddr, bool isPresent);</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;}</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">//Can leave rest of page directory as zero because present bit is 0</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">// essentially rest of memory is not present!!!!</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">// remove comments after may not compile</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">/*This function is responsible for enable paging */</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">in embedded asm</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">:outputs</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">:inputs</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">:clobber list</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="paging_8c.html#a1296393006772da66203c41cc9c6b0e7">  418</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="paging_8c.html#a1296393006772da66203c41cc9c6b0e7">set_registers</a>(){</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;  \n\</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="stringliteral">    movl %0, %%ecx  \n\</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="stringliteral">    movl %%ecx, %%cr3   \n\</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="stringliteral">    movl %%cr4, %%ecx   \n\</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="stringliteral">    orl $0x00000010, %%ecx  \n\</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="stringliteral">    movl %%ecx , %%cr4  \n\</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="stringliteral">    movl %%cr0, %%ecx   \n\</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="stringliteral">    orl $0x80000001, %%ecx  \n\</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="stringliteral">    movl %%ecx, %%cr0   \n\</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="stringliteral">    &quot;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    :               </div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    : <span class="stringliteral">&quot;r&quot;</span>(pgDir)   </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    :<span class="stringliteral">&quot;ecx&quot;</span>          </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    );</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;}</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">/*This function dosent take inputs or returns. The only responsibility for this is to flush tlb</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> We do this by doing a basic read and write using to cr3 using ecx. */</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="paging_8c.html#a75c9458effb320dbbbcec2dec2461e98">  439</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="paging_8c.html#a75c9458effb320dbbbcec2dec2461e98">flush_tlb</a>(<span class="keywordtype">void</span>) {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;  \n\</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="stringliteral">    movl %%cr3, %%ecx   \n\</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="stringliteral">    movl %%ecx, %%cr3   \n\</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="stringliteral">    &quot;</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    :</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    :</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    :<span class="stringliteral">&quot;ecx&quot;</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;}</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">/* insert_directory_entry</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"> * Inputs: none</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"> * Return Value: zero if pass, -1 if fail</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"> * Function: call initialize_memory_mp3 print pgDir pgTbl (only relevant info)*/</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="paging_8c.html#a70fb5de94e03816588d8be36ea77655d">  462</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="paging_8c.html#a70fb5de94e03816588d8be36ea77655d">initialize_memory_mp3_test</a>(){</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordtype">int</span> i ;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="paging_8c.html#a148dd03ddfff0c042f59ae1675e45b55">initialize_memory_mp3</a>()==0){</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">for</span>(i =0 ; i &lt; <a class="code" href="paging_8c.html#a66d0a76964334ef04b1f9aec7911b35d">PGDIRSIZE</a>; i++ ){</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <a class="code" href="lib_8c.html#a53ab10142f3fb4f01d4aee2a77b5310d">printf</a>(<span class="stringliteral">&quot;i = %d \n&quot;</span>, i);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <a class="code" href="lib_8c.html#a53ab10142f3fb4f01d4aee2a77b5310d">printf</a>(<span class="stringliteral">&quot;pgDir[i] = %d \n&quot;</span>, pgDir[i]);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <a class="code" href="lib_8c.html#a53ab10142f3fb4f01d4aee2a77b5310d">printf</a>(<span class="stringliteral">&quot;pgTbl[i] = %d \n &quot;</span>, pgTbl[i]);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="keywordflow">if</span>(pgDir[i]==0&amp;pgTbl[i]==0){</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">/* int main(){</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">    if(initialize_memory_mp3_test()!=0){</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">        printf(&quot;error from initialize_memory_mp3_test&quot;);</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">        return 0;</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">}</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div><div class="ttc" id="paging_8c_html_aeba7b3d514ccf2bab64ef5e363c6396a"><div class="ttname"><a href="paging_8c.html#aeba7b3d514ccf2bab64ef5e363c6396a">TWELVEMASK</a></div><div class="ttdeci">#define TWELVEMASK</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00134">paging.c:134</a></div></div>
<div class="ttc" id="types_8h_html"><div class="ttname"><a href="types_8h.html">types.h</a></div></div>
<div class="ttc" id="paging_8c_html_ae4f40bc32fc92f5b6bb29f837746fb4f"><div class="ttname"><a href="paging_8c.html#ae4f40bc32fc92f5b6bb29f837746fb4f">insert_directory_entry</a></div><div class="ttdeci">int insert_directory_entry(int isKB, int32_t physMemAddr, int isPresent)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00188">paging.c:188</a></div></div>
<div class="ttc" id="paging_8c_html_a2748566f4c443ee77aa831e63dbb5ebe"><div class="ttname"><a href="paging_8c.html#a2748566f4c443ee77aa831e63dbb5ebe">P</a></div><div class="ttdeci">#define P</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00125">paging.c:125</a></div></div>
<div class="ttc" id="paging_8c_html_a70fb5de94e03816588d8be36ea77655d"><div class="ttname"><a href="paging_8c.html#a70fb5de94e03816588d8be36ea77655d">initialize_memory_mp3_test</a></div><div class="ttdeci">int initialize_memory_mp3_test()</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00462">paging.c:462</a></div></div>
<div class="ttc" id="paging_8c_html_aa3563d3079ed62c037a8a8d8d6bc6ecd"><div class="ttname"><a href="paging_8c.html#aa3563d3079ed62c037a8a8d8d6bc6ecd">VIDEOINDEX</a></div><div class="ttdeci">#define VIDEOINDEX</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00143">paging.c:143</a></div></div>
<div class="ttc" id="paging_8c_html_a8de9701e91cb1faf82d939d43aa6b305"><div class="ttname"><a href="paging_8c.html#a8de9701e91cb1faf82d939d43aa6b305">clear_bit</a></div><div class="ttdeci">void clear_bit(int32_t *num, char bitNum)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00177">paging.c:177</a></div></div>
<div class="ttc" id="lib_8h_html"><div class="ttname"><a href="lib_8h.html">lib.h</a></div></div>
<div class="ttc" id="paging_8c_html_a148dd03ddfff0c042f59ae1675e45b55"><div class="ttname"><a href="paging_8c.html#a148dd03ddfff0c042f59ae1675e45b55">initialize_memory_mp3</a></div><div class="ttdeci">int initialize_memory_mp3(void)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00371">paging.c:371</a></div></div>
<div class="ttc" id="paging_8c_html_a708e40467feb1c2109c63cdf12d88c29"><div class="ttname"><a href="paging_8c.html#a708e40467feb1c2109c63cdf12d88c29">VIDEO</a></div><div class="ttdeci">#define VIDEO</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00118">paging.c:118</a></div></div>
<div class="ttc" id="paging_8c_html_a736169a1f5153bc211617999089d7db0"><div class="ttname"><a href="paging_8c.html#a736169a1f5153bc211617999089d7db0">set_dir_tbl_zero</a></div><div class="ttdeci">void set_dir_tbl_zero()</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00159">paging.c:159</a></div></div>
<div class="ttc" id="paging_8c_html_a9e08e3962b168376ed9a2bd84a1b990c"><div class="ttname"><a href="paging_8c.html#a9e08e3962b168376ed9a2bd84a1b990c">PGTBLSIZE</a></div><div class="ttdeci">#define PGTBLSIZE</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00124">paging.c:124</a></div></div>
<div class="ttc" id="paging_8c_html_a75c9458effb320dbbbcec2dec2461e98"><div class="ttname"><a href="paging_8c.html#a75c9458effb320dbbbcec2dec2461e98">flush_tlb</a></div><div class="ttdeci">void flush_tlb(void)</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00439">paging.c:439</a></div></div>
<div class="ttc" id="paging_8c_html_ad4661974a66daba2cf78a74dfbe67ebf"><div class="ttname"><a href="paging_8c.html#ad4661974a66daba2cf78a74dfbe67ebf">MEMSIZE</a></div><div class="ttdeci">#define MEMSIZE</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00139">paging.c:139</a></div></div>
<div class="ttc" id="paging_8h_html"><div class="ttname"><a href="paging_8h.html">paging.h</a></div></div>
<div class="ttc" id="paging_8c_html_ad7f630556c2cd30d8d8976e0f6e7f749"><div class="ttname"><a href="paging_8c.html#ad7f630556c2cd30d8d8976e0f6e7f749">PS</a></div><div class="ttdeci">#define PS</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00132">paging.c:132</a></div></div>
<div class="ttc" id="paging_8c_html_ae48e0a3cbad0db6c193274ff56038e0d"><div class="ttname"><a href="paging_8c.html#ae48e0a3cbad0db6c193274ff56038e0d">KERNEL_LOC</a></div><div class="ttdeci">#define KERNEL_LOC</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00141">paging.c:141</a></div></div>
<div class="ttc" id="x86__desc_8h_html"><div class="ttname"><a href="x86__desc_8h.html">x86_desc.h</a></div></div>
<div class="ttc" id="lib_8c_html_a53ab10142f3fb4f01d4aee2a77b5310d"><div class="ttname"><a href="lib_8c.html#a53ab10142f3fb4f01d4aee2a77b5310d">printf</a></div><div class="ttdeci">int32_t printf(int8_t *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="lib_8c_source.html#l00094">lib.c:94</a></div></div>
<div class="ttc" id="paging_8c_html_a1ba54f994a3bcceea6b1904cde7de8fe"><div class="ttname"><a href="paging_8c.html#a1ba54f994a3bcceea6b1904cde7de8fe">set_bit_one</a></div><div class="ttdeci">void set_bit_one(int32_t *num, char bitNum)</div><div class="ttdoc">step 1 set up tables (Michael Gulson) </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00172">paging.c:172</a></div></div>
<div class="ttc" id="paging_8c_html_a8e4a32a7b73774ffd986b8fc2399829b"><div class="ttname"><a href="paging_8c.html#a8e4a32a7b73774ffd986b8fc2399829b">__attribute__</a></div><div class="ttdeci">int32_t pgDir [PGDIRSIZE] __attribute__((aligned(MEMSIZE)))</div></div>
<div class="ttc" id="paging_8c_html_afc4ded33ac0ca43defcce639e965748a"><div class="ttname"><a href="paging_8c.html#afc4ded33ac0ca43defcce639e965748a">RW</a></div><div class="ttdeci">#define RW</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00126">paging.c:126</a></div></div>
<div class="ttc" id="paging_8c_html_a1296393006772da66203c41cc9c6b0e7"><div class="ttname"><a href="paging_8c.html#a1296393006772da66203c41cc9c6b0e7">set_registers</a></div><div class="ttdeci">void set_registers()</div><div class="ttdoc">step 2 set registers (Mak) </div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00418">paging.c:418</a></div></div>
<div class="ttc" id="paging_8c_html_a66d0a76964334ef04b1f9aec7911b35d"><div class="ttname"><a href="paging_8c.html#a66d0a76964334ef04b1f9aec7911b35d">PGDIRSIZE</a></div><div class="ttdeci">#define PGDIRSIZE</div><div class="ttdef"><b>Definition:</b> <a href="paging_8c_source.html#l00123">paging.c:123</a></div></div>
<div class="ttc" id="types_8h_html_a32f2e37ee053cf2ce8ca28d1f74630e5"><div class="ttname"><a href="types_8h.html#a32f2e37ee053cf2ce8ca28d1f74630e5">int32_t</a></div><div class="ttdeci">int int32_t</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00015">types.h:15</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
